<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindAR.js AR Anwendung</title>
    <!-- MindAR.js -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar/dist/mindar-three.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/build/three.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="ar-container" style="width: 100vw; height: 100vh;"></div>
    <script>
        // Initialisierung
        const startAR = async () => {
            const mindarThree = new window.MINDAR.Three({
                container: document.querySelector("#ar-container"),
                imageTargetSrc: "https://cdn.jsdelivr.net/npm/mind-ar/examples/assets/targets/band-example.mind"
            });

            const { renderer, scene, camera } = mindarThree;

            // Licht hinzufügen
            const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
            scene.add(light);

            // Kreis erstellen
            const circleGeometry = new THREE.CircleGeometry(0.55, 32);
            const circleMaterial = new THREE.MeshBasicMaterial({ color: 0x0077ff, side: THREE.DoubleSide });
            const circle = new THREE.Mesh(circleGeometry, circleMaterial);
            circle.rotation.x = -Math.PI / 2; // Horizontal platzieren
            circle.position.y = 0.01; // Leicht über dem Boden
            scene.add(circle);

            // Quader erstellen (aber versteckt)
            const quads = [];
            const quadGeometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
            const quadMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });

            const quadPositions = [
                { x: 0.6, z: 0 },
                { x: -0.6, z: 0 },
                { x: 0, z: 0.6 },
                { x: 0, z: -0.6 },
            ];

            quadPositions.forEach((pos) => {
                const quad = new THREE.Mesh(quadGeometry, quadMaterial);
                quad.position.set(pos.x, 0.1, pos.z);
                quad.visible = false; // Quader unsichtbar starten
                scene.add(quad);
                quads.push(quad);
            });

            // Funktion zur Überprüfung, ob der Benutzer über dem Kreis ist
            const isOverCircle = (cameraPosition) => {
                const dx = cameraPosition.x - circle.position.x;
                const dz = cameraPosition.z - circle.position.z;
                const distance = Math.sqrt(dx * dx + dz * dz);
                return distance <= 0.55; // Benutzer ist über dem Kreis
            };

            // Animation/Render-Schleife
            renderer.setAnimationLoop(() => {
                const cameraPosition = camera.position; // Kamera-Position abrufen
                if (isOverCircle(cameraPosition)) {
                    // Quader sichtbar machen, wenn der Benutzer über dem Kreis ist
                    quads.forEach((quad) => (quad.visible = true));
                } else {
                    // Quader verstecken, wenn der Benutzer nicht über dem Kreis ist
                    quads.forEach((quad) => (quad.visible = false));
                }

                renderer.render(scene, camera);
            });

            // AR starten
            await mindarThree.start();
        };

        // AR starten, wenn die Seite geladen wird
        window.onload = startAR;
    </script>
</body>
</html>
